<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Author: Thomas Baardemans, Supervisor: Marc Teunis (Hogeschool Utrecht)" />


<title>RNA-seq: Overview of DESeq2 method</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      code.sourceCode > span { display: inline-block; line-height: 1.25; }
  code.sourceCode > span { color: inherit; text-decoration: inherit; }
  code.sourceCode > span:empty { height: 1.2em; }
  .sourceCode { overflow: visible; }
  code.sourceCode { white-space: pre; position: relative; }
  div.sourceCode { margin: 1em 0; }
  pre.sourceCode { margin: 0; }
  @media screen {
  div.sourceCode { overflow: auto; }
  }
  @media print {
  code.sourceCode { white-space: pre-wrap; }
  code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
  }
  pre.numberSource code
    { counter-reset: source-line 0; }
  pre.numberSource code > span
    { position: relative; left: -4em; counter-increment: source-line; }
  pre.numberSource code > span > a:first-child::before
    { content: counter(source-line);
      position: relative; left: -1em; text-align: right; vertical-align: baseline;
      border: none; display: inline-block;
      -webkit-touch-callout: none; -webkit-user-select: none;
      -khtml-user-select: none; -moz-user-select: none;
      -ms-user-select: none; user-select: none;
      padding: 0 4px; width: 4em;
      color: #aaaaaa;
    }
  pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
  div.sourceCode
    {  background-color: #f8f8f8; }
  @media screen {
  code.sourceCode > span > a:first-child::before { text-decoration: underline; }
  }
  code span.al { color: #ef2929; } /* Alert */
  code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
  code span.at { color: #c4a000; } /* Attribute */
  code span.bn { color: #0000cf; } /* BaseN */
  code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
  code span.ch { color: #4e9a06; } /* Char */
  code span.cn { color: #000000; } /* Constant */
  code span.co { color: #8f5902; font-style: italic; } /* Comment */
  code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
  code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
  code span.dt { color: #204a87; } /* DataType */
  code span.dv { color: #0000cf; } /* DecVal */
  code span.er { color: #a40000; font-weight: bold; } /* Error */
  code span.ex { } /* Extension */
  code span.fl { color: #0000cf; } /* Float */
  code span.fu { color: #000000; } /* Function */
  code span.im { } /* Import */
  code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
  code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
  code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
  code span.ot { color: #8f5902; } /* Other */
  code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
  code span.sc { color: #000000; } /* SpecialChar */
  code span.ss { color: #4e9a06; } /* SpecialString */
  code span.st { color: #4e9a06; } /* String */
  code span.va { color: #000000; } /* Variable */
  code span.vs { color: #4e9a06; } /* VerbatimString */
  code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 52px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h2 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h3 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h4 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h5 {
  padding-top: 57px;
  margin-top: -57px;
}
.section h6 {
  padding-top: 57px;
  margin-top: -57px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Thomas Baardemans</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="RNA_seq_method.html">RNA-seq: Method</a>
</li>
<li>
  <a href="python.html">Python</a>
</li>
<li>
  <a href="https://nl.linkedin.com/in/thomas-baardemans">
    <span class="fa fa-linkedin"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><strong>RNA-seq: Overview of DESeq2 method</strong></h1>
<h4 class="author"><em>Author:</em> Thomas Baardemans, <em>Supervisor:</em> Marc Teunis (Hogeschool Utrecht)</h4>
<h4 class="date">28-Oct-2020</h4>

</div>


<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#Installing packages and loading libraries.</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># If bioconductor is not installed it can be installed by running the next line of code:</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="kw">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="dt">version =</span> <span class="st">&quot;3.11&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#Uncomment the following lines of code and run them to install the packages if they are not already installed.</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#BiocManager::install(&quot;airway&quot;)</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#BiocManager::install(&quot;DESeq2&quot;)</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#BiocManager::install(&quot;biomaRt&quot;)</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#BiocManager::install(&quot;apeglm&quot;)</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#BiocManager::install(&quot;airway&quot;)</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#install.packages(&quot;vcd&quot;)</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#install.packages(&quot;ade4&quot;)</span></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#Load the packages</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="kw">library</span>(DESeq2)</span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="kw">library</span>(SummarizedExperiment)</span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="kw">library</span>(airway)</span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="kw">library</span>(here)</span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="kw">library</span>(biomaRt)</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="kw">library</span>(vcd)</span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="kw">library</span>(ade4)</span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="kw">library</span>(factoextra)</span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="kw">library</span>(airway)</span></code></pre></div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> <strong>Introduction</strong></h1>
<p>RNA sequencing is currently the most widely used technique for quantifying gene expression (transcriptome) in tissues, cell cultures or even individual cells. Interpretation of the resulting data is not as straightforward as it might seem due to biases introduced by the methods used and biological variety between samples. In order to correctly analyse a transcriptome dataset it is important to understand methods used to obtain and analyze the data. This lesson aims to give the student a broad overview of a typical RNA-seq experiment. Furthermore it will also give an insight into the statistical tests used by the DESeq2 package (Love, Huber, Anders. 2014<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>) to test for differentially expressed genes. We will use the “airway” dataset that can be installed using bioconductor so the student can follow along using the code provided in the codeblocks.</p>
</div>
<div id="next-generation-sequencing-and-mapping-reads" class="section level1">
<h1><span class="header-section-number">2</span> <strong>Next Generation Sequencing and mapping reads</strong></h1>
<p>Before we can begin to understand any of the statistical tests used by DESeq2 we need to have a rough understanding of the experiment that produced the data and steps involved. RNA-seq experiments use Next Generation sequencers to quantify RNA molecules in cells or tissues. Each step in the experiment influences the data obtained in a different way so we will discuss the main steps seperately.</p>
<div id="experimental-design" class="section level2">
<h2><span class="header-section-number">2.1</span> Experimental design</h2>
<p>Cell/Bacteria cultures can be harvested or biopts can be taken from animals or patients. The minimal design has at least 1 experimental variable and 3 replications (samples) per group. Careful consideration of replication number is advised though since a study using 42 replications per group has shown that using just 3 replications only identifies 20-40% of differentially expressed genes depending on the tool used (Schurch, Nicholas J et al. 2016<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>). To identify &gt;85% of genes regardless of fold change 20 replications are required (fold change is a quantative measure of difference). They conclude at least 6-12 replications are recommended. Because scientists often want to maximize the amount of experimental conditions most of the datasets contain 3 replications.</p>
</div>
<div id="library-preparation" class="section level2">
<h2><span class="header-section-number">2.2</span> Library preparation</h2>
<p>After the RNA is extracted from the sample the ribosomal RNA (rRNA) needs to be removed. Over 90% of the RNA found in a cell is rRNA and only 1-2 % of the RNA is the mRNA we are interested in in a standard RNA-seq experiment (Conesa et al. 2016<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>). mRNA selection can be achieved by selecting for the poly(A) tail found on eukaryotic mRNA’s or by depleting rRNA. poly(A) selection yields better results but is not always possible in biopts and is never possible in bacteria because they do not have poly(A) tails in their mRNA’s. poly(A) selection also filters out other non coding DNA such as microRNAs (miRNAs) because they do not contain a poly A tail either. After selection the mRNA’s are fragmented and reverse transcripted to synthesize the cDNA library. The fragmentation is necessary because most Next Generation Sequencing machines can only sequence molecules up to 300 basepairs.</p>
<div class="figure" style="text-align: center">
<img src="images/cDNA_library.png" alt="Figure 1: Steps involved in cDNA library synthesis for a standard RNA-seq experiment." width="100%" />
<p class="caption">
Figure 1: Steps involved in cDNA library synthesis for a standard RNA-seq experiment.
</p>
</div>
</div>
<div id="next-generation-sequencing-ngs-and-read-depth" class="section level2">
<h2><span class="header-section-number">2.3</span> Next Generation Sequencing (NGS) and read depth</h2>
<p>After cDNA synthesis the fragments are ligated to adapters to attach the molecules to the nanowells in a flowcell. NGS uses 1 strand of the cDNA to synthesize the complementing strand using fluorescently labelled nucleotides. After each cycle a new nucleotide is attached and the flowcell is imaged in order to call the base.</p>
<p>Read depth (also know as sequencing depth) is a parameter with a different meaning depending on the experiment conducted. If a whole genome is sequenced the read depth is the number of times each nucleotide has been sequenced to call the base. In a typical whole genome experiment an average read depth of 30 to 50x is recommended by illumina. When using RNA-seq the read depth takes on a different meaning: It is the amount of reads that is “sampled” from the whole population of cDNA molecules in the library (tarazona et al. 2011<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>). This usually runs in the millions depending on the goal of the experiment and can be &gt; 100 million reads per sample. More read depth results in a more accurate quantification of genes that are expressed in low amounts.</p>
<p><em>Further reading: The complete method of NGS is beyond the scope of this lesson. For a more in-depth understanding of the NGS method you can watch this video: <a href="https://www.ibiology.org/techniques/next-generation-sequencing/#part-1" class="uri">https://www.ibiology.org/techniques/next-generation-sequencing/#part-1</a> (short read NGS starts at 06:46 and ends at 20:52).</em></p>
</div>
<div id="mapping-reads" class="section level2">
<h2><span class="header-section-number">2.4</span> Mapping reads</h2>
<p>Now that the sequences of the reads are known they need to be mapped to a reference genome and counted (each cDNA fragment that is sequenced is usually reffered to as a “read” or a “count”). Usually the raw sequences of the reads are submitted to the Short Read Archive (SRA) so other researchers can reproduce this step and every step hereafter. Mapping the reads to the genome proves to be harder than might be expected at first. One of the challenges is presented by the different isoforms of genes produced by alternative splicing. Over 90% of human genes are alternatively spliced producing a big amount of possible isoforms (Stark, Grzelak, Hadfield. 2019<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>). This leads to reads being mapped ambiguously (fitting on more than one isoform) making it hard to count which read belongs to which isoform.</p>
<div class="figure" style="text-align: center">
<img src="images/stark2019_adapted.png" alt="Figure 2: Ambiguous reads present a problem in assigning a read to specific isoform. Even splice junction spanning reads can be ambiguous. Using the unambiguous reads an estimate can be made about isoform prevalence. Adapted from Stark, Grzelak, Hadfield. 2019" width="100%" />
<p class="caption">
Figure 2: Ambiguous reads present a problem in assigning a read to specific isoform. Even splice junction spanning reads can be ambiguous. Using the unambiguous reads an estimate can be made about isoform prevalence. Adapted from Stark, Grzelak, Hadfield. 2019
</p>
</div>
<p>Paralogues reads prove to be an even harder problem to solve. Paralogues genes are genes that share a (relatively recent) common ancestor gene. This can lead to large portions of the sequence being completely identical. If a read falls within this zone it is impossible to know whether it belongs to gene x or y. Simply discarding these “multireads” can result in an underrepresentation of counts from genes that have lots of paralogues like the ubiquitin family for example. Some software (ERANGE) distributes these multireads in proportion to the number of unique and splice reads at similar loci (Mortazavi 2008<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>)</p>
<p><em>Further reading: To understand the algorithm used to map reads to the genome while making efficient use of computing resources (Burrows-Wheeler transform) watch this lecture by MIT professor David Gifford: <a href="https://www.youtube.com/watch?v=P3ORBMon8aw" class="uri">https://www.youtube.com/watch?v=P3ORBMon8aw</a></em></p>
<p>After assigning each read to a gene all the readcounts are stored in an expression matrix file (Also referred to as counts data or assay data). This expression matrix is sometimes also included in the expressionset uploaded to GEO but more often than not it is a seperate file included in the supplementary files. In other lessons of the course you will learn how to organize this expressionset into a neat dataset ready to be analyzed. For this lesson we will use a dataset called “airway” that can be downloaded/installed using bioconductor.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#load the dataset:</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">data</span>(airway)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#There should now be an &quot;airway&quot; object loaded into your global environment. </span></span></code></pre></div>
<p>The airway dataset has already been cleaned up and formed into a SummarizedExperiment ready for a differential expression analysis. Before we start analyzing it is important to first explore the dataset to see what we are actually working with.</p>
<p><strong>Exercise 1: Inspect the airway dataset using the metadata(), assay() and colData() functions from the SummarizedExperiment package. Use these functions to answer the following questions:</strong></p>
<ul>
<li><strong>What kind of cells have been used in the experiment?</strong></li>
<li><strong>How does the assaydata relate to the coldata?</strong></li>
<li><strong>What are the experimental conditions?</strong></li>
</ul>
<p>open the codeblock to reveal the answers.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Answer 1: airway smooth muscle cells (use metadata() function to see title and link to pubmed).</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co"># Answer 2: The columnnames of the assaydata are linked to rownames of the colData. So each row in the colData contains information about a sample (column in assaydata). </span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># Answer 3: Dex and cell. Read the pubmed abstract to get more info about dex. Because this dataset is only a subset of a bigger dataset there is also a variable called albut. All the samples untreated so its not an experimental group in our subset of the data. </span></span></code></pre></div>
</div>
</div>
<div id="differential-gene-expression-analysis" class="section level1">
<h1><span class="header-section-number">3</span> <strong>Differential gene expression analysis</strong></h1>
<p>Now we have our dataset loaded we can start to look for differences in expression between samples. However before we can run statistical test on the data there are a few steps to go through. These steps are included in the DESeq2 function. DESeq2 is basically a “wrapper” function that executes a number of other functions in the “background”. The purpose of these functions is roughly the following:</p>
<ul>
<li>Estimation of size factor</li>
<li>Estimation of dispersion</li>
<li>Testing</li>
</ul>
<p>In this chapter we will go through each step in but before we get there we will dive into the binomial and Poisson distributions distributions first.</p>
<div id="binomial-distribution" class="section level2">
<h2><span class="header-section-number">3.1</span> Binomial distribution</h2>
<p>A binomial distribution works with boolean values: true/false, 0 or 1, fail or succes. The simplest example of a binomial distribution is the coin toss. Each “cointoss” is called a Bernoulli trial.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#randomly generate 10 cointosses</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">##  [1] 0 1 1 1 0 0 1 0 0 0</span></span></code></pre></div>
<p>exercise: Use rbinom to simulate 100 <strong>double</strong> die rolls. Where throwing 6 is considered “succes” and everything below a “fail”. The results should show a “1” when a single 6 has been rolled and “2” when both die rolled a 6.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">#Answer:</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">rbinom</span>(<span class="dv">100</span>, <span class="dv">2</span>, <span class="dt">prob =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">##   [1] 1 0 0 0 1 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 1 0 0 0</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">##  [38] 0 0 0 1 0 0 1 0 0 1 0 0 2 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 1 0 1 1 0 0 0 0 1</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">##  [75] 0 0 0 0 1 1 0 0 1 0 0 0 1 0 0 0 0 0 1 0 0 1 0 0 0 0</span></span></code></pre></div>
<p>To get complete distribution of probabilities we use dbinom. note: use rbinom to generate data (r stands for random in this case). use dbinom to generate a probability. This also works with other statistical distributions as we will see later on in the lesson.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">#probability that 6 is thrown twice.</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">dbinom</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">prob =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">## [1] 0.02777778</span></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#to get the probabilities for all possible outcomes we use the colon. the chance of 3 succes if ofcourse zero because we only throw with 2 dice.</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="kw">dbinom</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">2</span>, <span class="dt">prob =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">## [1] 0.69444444 0.27777778 0.02777778 0.00000000</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">barplot</span>(<span class="kw">dbinom</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">2</span>, <span class="dt">prob =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>), <span class="dt">names.arg =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure">
<img src="RNA_seq_method_files/figure-html/echo%20is%20false-1.png" alt="Figure 3: Barplot of probabilities throwing 0,1 or 2 sixes." width="672" />
<p class="caption">
Figure 3: Barplot of probabilities throwing 0,1 or 2 sixes.
</p>
</div>
</div>
<div id="poisson-distribution" class="section level2">
<h2><span class="header-section-number">3.2</span> Poisson distribution</h2>
<p>When the probability of success p is small and the number of trials n large, the binomial distribution can be faithfully approximated by a simpler distribution, the Poisson distribution with rate parameter λ=np. (Recited from: Modern Statistics for Modern Biology<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">barplot</span>(<span class="kw">dpois</span>(<span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">lambda =</span> <span class="dv">6</span>), <span class="dt">names.arg =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">col =</span> <span class="st">&quot;#2780e3&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;k&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;P(X=k)&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-9-1.png" alt="figure 4: A barplot showing a Poisson distribution. k = number of occurences, P(X=k) = probability of succes given lambda" width="672" />
<p class="caption">
figure 4: A barplot showing a Poisson distribution. k = number of occurences, P(X=k) = probability of succes given lambda
</p>
</div>
<p>If we look at figure 4 there is an event with a <span class="math inline">\(\lambda\)</span> of 6. <span class="math inline">\(\lambda\)</span> might represent the number of letters someone has received on average each day for the last month. If we were to look at the mail that arrived on a given day there is a chance of 0.04 (P) of us counting 2 (<span class="math inline">\(\kappa\)</span>) pieces of mail.</p>
</div>
<div id="example-dna-mutation-rate" class="section level2">
<h2><span class="header-section-number">3.3</span> Example: DNA mutation rate</h2>
<p>A good example of a Poisson distribution is the mutation rate of DNA. If we want to know the amount of mutations we can we are likely to find in 1 kb of DNA we start with determining the <span class="math inline">\(\lambda\)</span> (event rate / Poisson mean). In this hypothetical example we examine 1 mb and find 307 mutations. So <span class="math inline">\(\lambda\)</span> = 312/1000 = 0.307. To calculate the probability we find 3 mutation in 1 kb of DNA we can use the following Poisson formula. Note that P(X=k) is the probability of observing <span class="math inline">\(\kappa\)</span>.</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"> <mi>P</mi> <mo stretchy="false">(</mo> <mi>X</mi> <mo>=</mo> <mi>k</mi> <mo stretchy="false">)</mo> <mo>=</mo> <mfrac> <mrow> <msup> <mi>λ<!-- λ --></mi> <mi>k</mi> </msup> <mspace width="thickmathspace" /> <msup> <mi>e</mi> <mrow class="MJX-TeXAtom-ORD"> <mo>−<!-- − --></mo> <mi>λ<!-- λ --></mi> </mrow> </msup> </mrow> <mrow> <mi>k</mi> <mo>!</mo> </mrow> </mfrac> <mo>.</mo> </math></p>
<p>So in this formula we input <span class="math inline">\(\lambda\)</span> = 0.307, <span class="math inline">\(\kappa\)</span> = 3. Note that the ! represents a factorial: n! = n * (n-1) * (n-2) … So our k! = 3<em>2</em>1 = 6. In R we can use this formula as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fl">0.312</span><span class="op">^</span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.307</span>) <span class="op">/</span><span class="st"> </span><span class="kw">factorial</span>(<span class="dv">3</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">## [1] 0.003723781</span></span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># However there is a function in R that will work equally well:</span></span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">dpois</span>(<span class="dt">x =</span> <span class="dv">3</span>, <span class="dt">lambda =</span> <span class="fl">0.307</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">## [1] 0.003547607</span></span></code></pre></div>
<p>so there is a probability 0.0035 that a given kb contains 3 mutations. So we expect to find about 4 sections of DNA to contain 3 mutations. To get P(X=k) for all the other<span class="math inline">\(\kappa\)</span> values we can change the code slightly:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>mutationprobability &lt;-<span class="st"> </span><span class="kw">dpois</span>(<span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">lambda =</span> <span class="fl">0.307</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>mutationprobability </span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">## [1] 0.7356506009 0.2258447345 0.0346671667 0.0035476067 0.0002722788</span></span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># To get the probability that there are 5 or more mutations in a kb we can simply subtract the sum of probabilities 0:4 from the number 1. We will need this later to perform a chi-squared test.</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>mutationprobability &lt;-<span class="st"> </span><span class="kw">c</span>(mutationprobability, <span class="dv">1</span><span class="op">-</span><span class="kw">sum</span>(mutationprobability))</span></code></pre></div>
and we can also plot these values to get a visual of the distribution
<div class="figure">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-12-1.png" alt="Figure 5: Distribution of mutations/kb for lambda = 0.307" width="672" />
<p class="caption">
Figure 5: Distribution of mutations/kb for lambda = 0.307
</p>
</div>
<p>Now we know the distribution that we would expect if the DNA mutationrate follows a Poisson distribution (figure 5) we can compare it against our observed data. After fragmenting our hypothetical sample DNA into 1kb pieces and sequencing them we get the following results:</p>
<table>
<caption>Table 1: expected and observed results.</caption>
<thead>
<tr class="header">
<th align="center">mutations</th>
<th align="center">expected number of fragments</th>
<th align="center">observed number of fragments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">735.651</td>
<td align="center">740</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">225.845</td>
<td align="center">218</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">34.667</td>
<td align="center">37</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">3.548</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="center">0.272</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">5+</td>
<td align="center">0.018</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>The results look fairly close to the expected results if the mutationrate of DNA follows a Poisson distribution. We can test this using a chi-squared test. The chi-squared test determines whether there is a statistically significant difference between expected frequencies and observed frequencies.</p>
<p>H0: Observed frequencies follow expected frequencies, the mutationrate of DNA follows a Poisson distrubution.<br />
H1: Observed frequencies do not follow expected frequencies, the mutationrate of DNA does not follow a Poisson distribution</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">chisq.test</span>(<span class="dt">x =</span> mutationresults, <span class="dt">p =</span> mutationprobability)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">## </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">##  Chi-squared test for given probabilities</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">## </span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">## data:  mutationresults</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">## X-squared = 1.3396864, df = 5, p-value = 0.9307955</span></span></code></pre></div>
<p>the p-value &gt; 0.05 so we accept H0.</p>
</div>
<div id="exercise-v1-flying-bomb.-guided-weapon-or-a-case-of-poisson-distribution" class="section level2">
<h2><span class="header-section-number">3.4</span> Exercise: V1 flying bomb. Guided weapon or a case of Poisson distribution?</h2>
<div class="figure" style="text-align: center">
<img src="images/V1_cutaway.JPG" alt="Figure 6: Illustration of a V1 flying bomb. The V stands for 'vergeltungswaffen' (vengeance weapon) and was used to terrorize London civilians in the second world war." width="100%" />
<p class="caption">
Figure 6: Illustration of a V1 flying bomb. The V stands for ‘vergeltungswaffen’ (vengeance weapon) and was used to terrorize London civilians in the second world war.
</p>
</div>
<p>Poisson distributions occur in all kinds of unexpected places. During World War 2 the German army developed a flying bomb (V1 and later V2) to terrorize civilians in London. The impact sites of these bombs tended to be grouped in clusters. This made the English wonder whether these clusters were the result of some aiming mechanism on the bombs or if it was just chance. Statistician R. D. Clarke set out to tackle this problem (Clarke 1946<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>). He selected a 144 km<sup>2</sup>area on the map of south London and divided it in 576 squares of 0,25 km<sup>2</sup>. Counting the recorded impacts over the last x months Clarke determined there had been 537 impacts of flying bombs in the selected area.</p>
<p><strong>Exercise 2: Use the information given above to calculate the probabilities that a given square had 0,1,2,3,4 or 5+ impacts if the impacts were distributed according Poisson probability.</strong></p>
<p>Open the codeblock to reveal the answer.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">#First we calculate the chance that a given square got bombed 0,1,2,3 or 4 times.</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>zero_to_four &lt;-<span class="st"> </span><span class="kw">dpois</span>(<span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">lambda =</span> <span class="dv">537</span><span class="op">/</span><span class="dv">576</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#The chance a square gets impacted 5 or more times is 1 minus the sum of chances it gets hit 0 to 4 times. </span></span>
<span id="cb12-5"><a href="#cb12-5"></a>five_plus &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw">sum</span>(zero_to_four)</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#Concatenating the chances.</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>poissonexpectation &lt;-<span class="st"> </span><span class="kw">c</span>(zero_to_four, five_plus)</span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#Show the complete vector of probabilities (from 0 to 5+):</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>poissonexpectation</span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">## [1] 0.393650560040 0.366997136704 0.171074186120 0.053163679367 0.012391013811</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">## [6] 0.002723423957</span></span></code></pre></div>
<p>Next Clarke counted the number of squares that contained 0,1,2,3,4 and 5+ bomb impacts. Clarke hypothesized that if the V1 flying bombs contained an aiming mechanism there would be a disproportionate amount of squares containing either relatively high number of impacts or none at all.</p>
<table>
<caption>Table 2: R.D. Clarke’s results</caption>
<thead>
<tr class="header">
<th align="center">impacts per square</th>
<th align="center">expected amount of squares</th>
<th align="center">actual amount of squares</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">226.74</td>
<td align="center">229</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">211.39</td>
<td align="center">211</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">98.54</td>
<td align="center">93</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">30.62</td>
<td align="center">35</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="center">7.14</td>
<td align="center">7</td>
</tr>
<tr class="even">
<td align="center">5+</td>
<td align="center">1.57</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p><strong>Exercise 3:Perform a chi-squared test to verify the results follow the Poisson distribution using the chisq.test function in R.</strong></p>
<p>Open the codeblock to reveal the answer.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>bombdata &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">229</span>, <span class="dv">211</span>, <span class="dv">93</span>, <span class="dv">35</span>, <span class="dv">7</span>, <span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># chi square testing </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="kw">chisq.test</span>(<span class="dt">x =</span> bombdata, <span class="dt">p =</span> poissonexpectation)</span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">## </span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">##  Chi-squared test for given probabilities</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">## </span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">## data:  bombdata</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">## X-squared = 1.1691547, df = 5, p-value = 0.9478021</span></span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#This result is in line with what we know about the V1 today: It could only be aimed in the general direction of London but not guided to a more specific target like a building or a block of buildings. </span></span></code></pre></div>
</div>
<div id="maximum-likelihood-estimation" class="section level2">
<h2><span class="header-section-number">3.5</span> Maximum likelihood estimation</h2>
<p>So far we have used a top-down approach. We had a big dataset with a known <span class="math inline">\(\lambda\)</span> and we compared it to the distribution with the same <span class="math inline">\(\lambda\)</span>. Usually the <span class="math inline">\(\lambda\)</span> that generated the data is not known and has to be estimated. Estimating a parameter like this can be done using a method called maximum likelihood estimation (MLE). MLE calculated the <span class="math inline">\(\lambda\)</span> which makes the observed data most probable to observe. To understand how this method works we can generate a Poisson dataset with a known <span class="math inline">\(\lambda\)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#Create 40 Poisson distributed data points. We set the $\lambda$ to be 100 however we are going to pretend we dont know the $\lambda$ is 100 and try to estimate $\lambda$ from the data.</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>reads &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dt">n =</span> <span class="dv">40</span>, <span class="dt">lambda =</span> <span class="dv">100</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">reads =</span> reads), <span class="kw">aes</span>(<span class="dt">x =</span> reads)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">40</span>)</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">#calculate single datapoint for a single $\lambda$</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">dpois</span>(reads[<span class="dv">1</span>], <span class="dt">lambda =</span> <span class="dv">95</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">## [1] 0.02096213199</span></span></code></pre></div>
<p>After taking a look at the plot we decide the <span class="math inline">\(\lambda\)</span> must lie somewhere between 70 and 130. So we want to know what <span class="math inline">\(\lambda\)</span> between 70 and 130 is most likely for the first data point.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">dpois</span>(reads[<span class="dv">1</span>], <span class="dt">lambda =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">70</span>, <span class="dt">to =</span> <span class="dv">130</span>))</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">##  [1] 1.319737568e-05 2.183664031e-05 3.537944339e-05 5.616103013e-05</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">##  [5] 8.739361458e-05 1.333880268e-04 1.997879214e-04 2.937993517e-04</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">##  [9] 4.243921754e-04 6.024439923e-04 8.407931025e-04 1.154165367e-03</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">## [13] 1.558941822e-03 2.072740175e-03 2.713794226e-03 3.500130486e-03</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">## [17] 4.448560072e-03 5.573524614e-03 6.885855612e-03 8.391524877e-03</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">## [21] 1.009047709e-02 1.197564199e-02 1.403222161e-02 1.623733688e-02</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">## [25] 1.856009753e-02 2.096213199e-02 2.339858048e-02 2.581951969e-02</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">## [29] 2.817175276e-02 3.040086846e-02 3.245345070e-02 3.427930594e-02</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co">## [33] 3.583357381e-02 3.707859370e-02 3.798541881e-02 3.853489438e-02</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">## [37] 3.871824893e-02 3.853718096e-02 3.800345729e-02 3.713806959e-02</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">## [41] 3.597002079e-02 3.453483072e-02 3.287286084e-02 3.102756010e-02</span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co">## [45] 2.904372902e-02 2.696588822e-02 2.483682222e-02 2.269635072e-02</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="co">## [49] 2.058036066e-02 1.852011301e-02 1.654182127e-02 1.466648406e-02</span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="co">## [53] 1.290994318e-02 1.128313047e-02 9.792463075e-03 8.440345263e-03</span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="co">## [57] 7.225736731e-03 6.144751030e-03 5.191252706e-03 4.357427778e-03</span></span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="co">## [61] 3.634308322e-03</span></span>
<span id="cb16-18"><a href="#cb16-18"></a></span>
<span id="cb16-19"><a href="#cb16-19"></a>likelihood &lt;-<span class="st"> </span><span class="kw">dpois</span>(reads[<span class="dv">1</span>], <span class="dt">lambda =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">70</span>, <span class="dt">to =</span> <span class="dv">130</span>))</span>
<span id="cb16-20"><a href="#cb16-20"></a>likelihood &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">likelihood =</span> likelihood)</span>
<span id="cb16-21"><a href="#cb16-21"></a></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> likelihood, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">70</span>, <span class="dt">to =</span> <span class="dv">130</span>), <span class="dt">y =</span> likelihood)) <span class="op">+</span></span>
<span id="cb16-23"><a href="#cb16-23"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>As you can see there are a lot of small numbers. Because these numbers sometimes need to be multiplied later on in the estimation process we use a log transform. This transform is done because multiplying very small numbers soon become smaller than the CPU of the computer can represent in its memory (arithmatic underflow). To do this we can simply add “log = TRUE” to the dpois function.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>log_likelihood &lt;-<span class="st"> </span><span class="kw">dpois</span>(reads[<span class="dv">1</span>], <span class="dt">lambda =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">70</span>, <span class="dt">to =</span> <span class="dv">130</span>), <span class="dt">log =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>log_likelihood &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">log_likelihood =</span> log_likelihood)</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> log_likelihood, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">70</span>, <span class="dt">to =</span> <span class="dv">130</span>), <span class="dt">y =</span> log_likelihood)) <span class="op">+</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Until now we only took 1 datapoint and calculated the likelihood it was generated by a <span class="math inline">\(\lambda\)</span> from 70 to 130. To estimate the <span class="math inline">\(\lambda\)</span> of the complete dataset we are going to take the sum of probabilities at each datapoint. To do this we first write a function to calculate the sum of 1 datapoint:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>MLE_function &lt;-<span class="st"> </span><span class="cf">function</span>(lambda, datapoint){</span>
<span id="cb18-2"><a href="#cb18-2"></a>  probabilities &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dpois</span>(datapoint, lambda, <span class="dt">log =</span> <span class="ot">TRUE</span>))</span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="kw">return</span>(probabilities)</span>
<span id="cb18-4"><a href="#cb18-4"></a>}</span></code></pre></div>
<p>Next we can apply the function to all the datapoints:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>all_data_log_likelihood &lt;-<span class="st"> </span>(<span class="kw">sapply</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">70</span>, <span class="dt">to =</span> <span class="dv">130</span>),<span class="cf">function</span>(x){<span class="kw">MLE_function</span>(x,reads)}))</span>
<span id="cb19-2"><a href="#cb19-2"></a>all_data_log_likelihood &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">all_data_log_likelihood =</span> all_data_log_likelihood, <span class="dt">lambda =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">70</span>, <span class="dt">to =</span> <span class="dv">130</span>))</span></code></pre></div>
<p>And plot the results with a red line showing the most likely estimate of <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> all_data_log_likelihood, <span class="kw">aes</span>(<span class="dt">x =</span> lambda, <span class="dt">y =</span> all_data_log_likelihood)) <span class="op">+</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> all_data_log_likelihood<span class="op">$</span>lambda[<span class="kw">which.max</span>(all_data_log_likelihood<span class="op">$</span>all_data_log_likelihood)], <span class="dt">color=</span><span class="st">&quot;red&quot;</span>,<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;probability&quot;</span>)</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Depending on your seed the <span class="math inline">\(\lambda\)</span> estimated can vary but it should approach 100.</p>
<p><em><span class="citation">@Marc</span>: We hadden dit vorige week al besproken maar de MLE lambda is nogsteeds gelijk aan het gemiddelde van de reads. Misschien is Poisson gewoon een slecht voorbeeld om een MLE mee te doen. In principe is het bovenstaande stuk over MLE nu zo goed als gelijk aan de website die je mij doorstuurde: <a href="https://cmdlinetips.com/2019/03/introduction-to-maximum-likelihood-estimation-in-r/" class="uri">https://cmdlinetips.com/2019/03/introduction-to-maximum-likelihood-estimation-in-r/</a></em></p>
</div>
<div id="estimation-of-size-factor" class="section level2">
<h2><span class="header-section-number">3.6</span> Estimation of size factor</h2>
<p>When comparing the read counts of a gene between 2 experimental conditions we need to make sure that the difference is only influenced by the treatment and not by any other variables. For example: If the read depth of 1 sample x is twice the size of samply y we are likely to find twice as many reads for each gene. This makes it hard to compare samples so we need to correct for this difference. We can first take al ook at the total reads per treatment:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">#total reads per treatment.</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">sum</span>(<span class="kw">assay</span>(airway[,airway<span class="op">$</span>dex <span class="op">==</span><span class="st"> &quot;trt&quot;</span>]))</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">## [1] 85955244</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="kw">sum</span>(<span class="kw">assay</span>(airway[,airway<span class="op">$</span>dex <span class="op">==</span><span class="st"> &quot;untrt&quot;</span>]))</span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">## [1] 89561179</span></span></code></pre></div>
<p>The difference is not huge. But its still 3.6 million reads less in the treated group. Could it be that the treated group has some genes downregulated? Or is something else going on? The difference becomes more apparent if we take a look at the individual samples in figure 8. The total amount of reads ranges from 15 million to over 30 million within the treated condition! This difference can be due to multiple reasons: Conditions in the well might have been slightly different leading to quicker cellgrowth or the samples might nog have an equal sequencing depth.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">#create a dataframe with the total reads of all samples and their treatment. </span></span>
<span id="cb22-2"><a href="#cb22-2"></a>reads_per_sample &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">reads =</span> <span class="kw">c</span>(<span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">1</span>])), </span>
<span id="cb22-3"><a href="#cb22-3"></a>                                         <span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">2</span>])),</span>
<span id="cb22-4"><a href="#cb22-4"></a>                                         <span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">3</span>])),</span>
<span id="cb22-5"><a href="#cb22-5"></a>                                         <span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">4</span>])),</span>
<span id="cb22-6"><a href="#cb22-6"></a>                                         <span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">5</span>])),</span>
<span id="cb22-7"><a href="#cb22-7"></a>                                         <span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">6</span>])),</span>
<span id="cb22-8"><a href="#cb22-8"></a>                                         <span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">7</span>])),</span>
<span id="cb22-9"><a href="#cb22-9"></a>                                         <span class="kw">sum</span>(<span class="kw">assay</span>(airway[,<span class="dv">8</span>]))),</span>
<span id="cb22-10"><a href="#cb22-10"></a>                               <span class="dt">dextreatment =</span> <span class="kw">colData</span>(airway)<span class="op">$</span>dex </span>
<span id="cb22-11"><a href="#cb22-11"></a>                                )  </span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> reads_per_sample, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">y =</span> reads, <span class="dt">fill =</span> dextreatment)) <span class="op">+</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="st">  </span><span class="kw">geom_col</span>()</span></code></pre></div>
<div class="figure">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-28-1.png" alt="Figure 8: Read depth varies between samples." width="672" />
<p class="caption">
Figure 8: Read depth varies between samples.
</p>
</div>
<p>In order to adjust for this effect we need to scale the reads so the total amount of reads will become (more) equal between samples. To do this we calculate a size factor. We could take the total reads of sample 2 and divide by the total reads of sample 1. 320/260 = 1.231. We could use this size factor to correct the reads of each genes so that the total number of reads in each sample will become equal. This method is flawed as we can see in figure 9. The blue line represents the size factor we just calculated. Using this size factor implies gene A,B,D and E are upregulated and gene C is downregulated. However this is not likely the case. It is more likely that A,B,D and E are present in equal amounts in both samples and gene C is downregulated in sample 2. The higher countnumber of A,B,D and E is a result of the difference in read depth. If we plot a regression line through these points (red line) we get a more exact size factor that estimates only the difference in read depth and not the difference in expression of genes (If lots of genes are upregulated it is expected to find more mRNA’s in a cell overall). In this hypothetical dataset the sizefactor calculated by the red line is 1.5. This last method is what DESeq2 uses to estimate the size factor.</p>
<div class="figure" style="text-align: center">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-29-1.png" alt="Figure 9: estimation of size factor. Dots represent genes. Blue and red lines represent two ways of size factor esimation. source: Modern Statistics for Modern Biology" width="75%" />
<p class="caption">
Figure 9: estimation of size factor. Dots represent genes. Blue and red lines represent two ways of size factor esimation. source: Modern Statistics for Modern Biology
</p>
</div>
<p>As we discussed earlier DESeq2 is a wrapper function. The functions within it can often be called separately like the size-factor-estimation function.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">#estimate the sizefactors and return them</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>estim &lt;-<span class="st"> </span>DESeq2<span class="op">::</span><span class="kw">estimateSizeFactorsForMatrix</span>(<span class="kw">assay</span>(airway))</span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co">#mutate the size factor into the dataframe</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>reads_per_sample &lt;-<span class="st"> </span><span class="kw">mutate</span>(reads_per_sample, </span>
<span id="cb24-6"><a href="#cb24-6"></a>                           <span class="dt">sizefactor =</span> estim)</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="co">#calculate the adjusted reads using the sizefactor.</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>reads_per_sample &lt;-<span class="st"> </span><span class="kw">mutate</span>(reads_per_sample,</span>
<span id="cb24-10"><a href="#cb24-10"></a>                           <span class="dt">reads_adjust =</span> reads_per_sample<span class="op">$</span>reads<span class="op">/</span>reads_per_sample<span class="op">$</span>sizefactor)</span></code></pre></div>
<p>Now we have adjusted the reads for the size factor we can plot the total reads again and see if the samples have become more equal:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> reads_per_sample, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">y =</span> reads_adjust, <span class="dt">fill =</span> dextreatment)) <span class="op">+</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="st">  </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>As you can see the range of total reads has drastically decreased. All samples now have between 20 and about 22,5 million total reads.</p>
<p>Note: if you look at the help page of estimateSizeFactorsForMatrix you might notice the function also accepts an optional argument called controlGenes. The control genes can come in 2 forms:</p>
<ul>
<li>Spike-in genes: These are artificial mRNA sequences that can be added in a known quantity to the sample.</li>
<li>Housekeeping genes: These genes are essential for basic maintenance and function of the cell. Some of these are expressed at relatively constant rates.</li>
</ul>
</div>
<div id="estimating-dispersion-and-negative-binomial-distribution" class="section level2">
<h2><span class="header-section-number">3.7</span> Estimating dispersion and negative binomial distribution</h2>
<p>At first it was believed that the expression of a gene followed a Poisson distribution. It turned out however that this was only the case when evaluating samples that were technical replicates.</p>
<p>The main problem with the Poisson distribution is the <span class="math inline">\(\lambda\)</span> parameter because in this distribtion: <span class="math inline">\(\lambda\)</span> = mean = variance. To accurately model the data we need a distribution that uses separate parameters for mean and variance (dispersion). This is where the negative binomial distribution comes in. It accepts these parameters and is used by DEseq to model the data. Before we can use this distribution however we do need to find out what these 2 parameters are. The mean is simple enough but what about the dispersion parameter?</p>
<p>Estimating dispersion of a gene is hard/impossible if you only have 3 samples per experiment group because n is too small. You would need quite alot of samples to accurately predict the dispersion and quite often you are working with data gathered by someone else so this is simply not an option. As a solution DESeq2 assumes genes of similar average expression have a similar dispersion (Love et al 2014). DEseq2 calculates the dispersion of individual genes and then calculates an average dispersion of genes that are expressed in simular quantities. It then “shrinks” the individual dispersions towards the average dispersion. To get a better understanding of this shrinking it is useful to plot the dispersion in your dataset (figure 10).</p>
<div class="figure" style="text-align: center">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-32-1.png" alt="Figure 10: Plot of dispersion estimates of airway dataset. The black dots represent the dispersion calculated for a given gene (gene-wise estimate). the average dispersion of genes with simular expression (mean of counts) is calculated. A red line is fitted trough the average dispersions and the genes are shrunken toward the red line resulting in the blue dots. The blue dot represent the final estimated dispersion of a gene. The thicker blue dots in the uppermost part of the graph are considered outliers and for this reason they are not shrunk towards the fitted value." width="100%" />
<p class="caption">
Figure 10: Plot of dispersion estimates of airway dataset. The black dots represent the dispersion calculated for a given gene (gene-wise estimate). the average dispersion of genes with simular expression (mean of counts) is calculated. A red line is fitted trough the average dispersions and the genes are shrunken toward the red line resulting in the blue dots. The blue dot represent the final estimated dispersion of a gene. The thicker blue dots in the uppermost part of the graph are considered outliers and for this reason they are not shrunk towards the fitted value.
</p>
</div>
<p>To get the calculated dispersion we can use the dispersions() function:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>dispersiondataframe &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">assay</span>(ddsDE_airway)) <span class="op">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">disp =</span> <span class="kw">dispersions</span>(ddsDE_airway))</span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="kw">head</span>(dispersiondataframe)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">##   SRR1039508 SRR1039509 SRR1039512 SRR1039513 SRR1039516 SRR1039517 SRR1039520</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">## 1        679        448        873        408       1138       1047        770</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">## 2        467        515        621        365        587        799        417</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">## 3        260        211        263        164        245        331        233</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">## 4         60         55         40         35         78         63         76</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co">## 5       3251       3679       6177       4252       6721      11027       5176</span></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="co">## 6       1433       1062       1733        881       1424       1439       1359</span></span>
<span id="cb26-12"><a href="#cb26-12"></a><span class="co">##   SRR1039521           disp</span></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="co">## 1        572 0.027339410959</span></span>
<span id="cb26-14"><a href="#cb26-14"></a><span class="co">## 2        508 0.007813516794</span></span>
<span id="cb26-15"><a href="#cb26-15"></a><span class="co">## 3        229 0.011124686099</span></span>
<span id="cb26-16"><a href="#cb26-16"></a><span class="co">## 4         60 0.069839646073</span></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="co">## 5       7995 0.064169948967</span></span>
<span id="cb26-18"><a href="#cb26-18"></a><span class="co">## 6       1109 0.012967940843</span></span></code></pre></div>
<p>Once the mean and dispersion of each gene have been estimated DESeq2 tests for significant differential expression between genes before and after treatment. Once the analysis is complete we can get the results using the res() function. Next we arrange genes so that the genes with the smallest p adjusted come first and show the head of the results:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>res &lt;-<span class="st"> </span><span class="kw">results</span>(ddsDE_airway)</span>
<span id="cb27-2"><a href="#cb27-2"></a>res[<span class="kw">order</span>(res<span class="op">$</span>padj), ] <span class="op">%&gt;%</span><span class="st"> </span>head</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co">## log2 fold change (MLE): dex untrt vs trt </span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co">## Wald test p-value: dex untrt vs trt </span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co">## DataFrame with 6 rows and 6 columns</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co">##                  baseMean log2FoldChange     lfcSE      stat       pvalue</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="co">##                 &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="co">## ENSG00000152583   997.445       -4.60255 0.2117419  -21.7366 9.24620e-105</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="co">## ENSG00000148175 11193.723       -1.45149 0.0848958  -17.0974  1.55289e-65</span></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="co">## ENSG00000179094   776.600       -3.18388 0.2015094  -15.8002  3.10293e-56</span></span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="co">## ENSG00000134686  2737.982       -1.38717 0.0916587  -15.1341  9.65548e-52</span></span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="co">## ENSG00000125148  3656.267       -2.20347 0.1474191  -14.9470  1.63019e-50</span></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co">## ENSG00000120129  3409.038       -2.94901 0.2015464  -14.6319  1.75745e-48</span></span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="co">##                         padj</span></span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="co">##                    &lt;numeric&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="co">## ENSG00000152583 1.70269e-100</span></span>
<span id="cb27-17"><a href="#cb27-17"></a><span class="co">## ENSG00000148175  1.42982e-61</span></span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="co">## ENSG00000179094  1.90468e-52</span></span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="co">## ENSG00000134686  4.44514e-48</span></span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="co">## ENSG00000125148  6.00399e-47</span></span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="co">## ENSG00000120129  5.39389e-45</span></span></code></pre></div>
<p>Annotating the results to show a gene-name instead of a ensembl ID will be covered in another lesson.</p>
</div>
</div>
<div id="exploring-results" class="section level1">
<h1><span class="header-section-number">4</span> <strong>Exploring results</strong></h1>
<div id="histogram-of-p-values" class="section level2">
<h2><span class="header-section-number">4.1</span> Histogram of p-values</h2>
<p>The first plot is a histogram of p-values (figure 11). The left peak is the number of genes with a p &lt; 0.01. This plot gives us the possibility to make a rough estimation of the False Discovery Rate (FDR). Because we are looking at so many genes there are bound to be some genes that just happen to be differentially expressed. Looking at the area to the right of p &gt; 0.05 we get an idea of the scale of this “background”.</p>
<p>For example: If we look at the background we see that about 175-200 genes happen to have a p-value of 0.75. The same goes for most p-values &gt; 0.10. So it is likely that about 175-200 genes in the left peak just happen to be differentially expressed regardless of the experimental condition. About 2900 genes in total have a p &lt; 0.01. 200/2900 = 0.068. So about 7% of our differentially expressed genes are false positives (type I error).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>res &lt;-<span class="st"> </span><span class="kw">results</span>(ddsDE_airway)</span>
<span id="cb28-2"><a href="#cb28-2"></a>  </span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="kw">ggplot</span>(<span class="kw">as</span>(res, <span class="st">&quot;data.frame&quot;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> pvalue)) <span class="op">+</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>, <span class="dt">fill =</span> <span class="st">&quot;Royalblue&quot;</span>, <span class="dt">boundary =</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="figure">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-35-1.png" alt="Figure 101 Histogram of P values for the airway dataset results." width="672" />
<p class="caption">
Figure 101 Histogram of P values for the airway dataset results.
</p>
</div>
</div>
<div id="log2-fold-change-and-shrinkage" class="section level2">
<h2><span class="header-section-number">4.2</span> Log2 fold change and shrinkage</h2>
<p>After running DESeq2 and taking a look at the results you might notice a column for the log2FoldChange and one for the lfcSE. Log2FoldChange is a parameter that is calculated to show the relative difference in expression. Regular expression amounts of genes varies wildly from a couple of counts up to 400.000 in the airway dataset. This makes hard to visualize the increase or decrease of expression. So lets make a hypothetical dataset and to experiment on:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">genes =</span> <span class="kw">c</span>(<span class="st">&quot;gene1&quot;</span>, <span class="st">&quot;gene2&quot;</span>, <span class="st">&quot;gene3&quot;</span>, <span class="st">&quot;gene4&quot;</span>),</span>
<span id="cb29-2"><a href="#cb29-2"></a>                 <span class="dt">sample1 =</span> <span class="kw">c</span>(<span class="dv">1000</span>,<span class="dv">23</span>,<span class="dv">230000</span>,<span class="dv">7523</span>),</span>
<span id="cb29-3"><a href="#cb29-3"></a>                 <span class="dt">sample2 =</span> <span class="kw">c</span>(<span class="dv">8000</span>,<span class="dv">85</span>,<span class="dv">200000</span>,<span class="dv">3250</span>))</span>
<span id="cb29-4"><a href="#cb29-4"></a>df</span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="co">##   genes sample1 sample2</span></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co">## 1 gene1    1000    8000</span></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="co">## 2 gene2      23      85</span></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="co">## 3 gene3  230000  200000</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="co">## 4 gene4    7523    3250</span></span></code></pre></div>
<p>Now in order to quickly view how much each gene has changed we calculate the “fold change”. For example: If sample 1 is the “before treatment” and sample 2 is “after treatment”. We simply take the expression of sample 2 and divide it by the expression of sample 1. If the result is &gt;1 the gene is upregulated after treatment.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>df &lt;-<span class="st"> </span><span class="kw">mutate</span>(df, </span>
<span id="cb30-2"><a href="#cb30-2"></a>             <span class="dt">foldchange =</span> df<span class="op">$</span>sample2 <span class="op">/</span><span class="st"> </span>df<span class="op">$</span>sample1)</span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a>df</span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="co">##   genes sample1 sample2   foldchange</span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co">## 1 gene1    1000    8000 8.0000000000</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="co">## 2 gene2      23      85 3.6956521739</span></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co">## 3 gene3  230000  200000 0.8695652174</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="co">## 4 gene4    7523    3250 0.4320085072</span></span>
<span id="cb30-10"><a href="#cb30-10"></a></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> genes, <span class="dt">y =</span> foldchange)) <span class="op">+</span></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Now this graph shows the fold change for all the upregulated genes are &gt;1 and all the downregulated genes are between 0 an 1. These downregulated genes are a problem now because its still hard to compare upregulation and downregulation.</p>
<p>The solution is taking the log2 of the fold change:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>df &lt;-<span class="st"> </span><span class="kw">mutate</span>(df, </span>
<span id="cb31-2"><a href="#cb31-2"></a>             <span class="dt">log2foldchange =</span> <span class="kw">log2</span>(df<span class="op">$</span>foldchange))</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>df</span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="co">##   genes sample1 sample2   foldchange log2foldchange</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co">## 1 gene1    1000    8000 8.0000000000   3.0000000000</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co">## 2 gene2      23      85 3.6956521739   1.8858289801</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co">## 3 gene3  230000  200000 0.8695652174  -0.2016338612</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="co">## 4 gene4    7523    3250 0.4320085072  -1.2108683722</span></span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> genes, <span class="dt">y =</span> log2foldchange)) <span class="op">+</span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-38-1.png" width="672" /> notice that due to the logarithmic scaling a gene with a fold change of 8 has a log2fold change of 3 because 2x2x2 = 8.</p>
<p>The result is a much clearer graph of relative differences in gene expression.</p>
<p>The other parameter in the DESeq2 results is the lfcSE. This is short for Log2FoldChange Shrinkage Estimate. Shrinking the data is done because genes with low counts have less “statistical information”. The effect of this shrinkage is usually visualized using a MA plot. Shrinkage is estimated using a Empirical Bayes method. Bayesian statistics fall outside of the scope for this lesson but learning about it is time well-spent.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">data</span>(airway)</span>
<span id="cb32-2"><a href="#cb32-2"></a>ddsSE_airway &lt;-<span class="st"> </span>DESeq2<span class="op">::</span><span class="kw">DESeqDataSet</span>(airway, <span class="dt">design =</span>  <span class="op">~</span>dex)</span>
<span id="cb32-3"><a href="#cb32-3"></a>keep &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">counts</span>(ddsSE_airway)) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>ddsSE_airway &lt;-<span class="st"> </span>ddsSE_airway[keep,]</span>
<span id="cb32-5"><a href="#cb32-5"></a>ddsDE_airway &lt;-<span class="st"> </span><span class="kw">DESeq</span>(ddsSE_airway)</span>
<span id="cb32-6"><a href="#cb32-6"></a>res &lt;-<span class="st"> </span><span class="kw">results</span>(ddsDE_airway)</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="kw">resultsNames</span>(ddsDE_airway)</span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="co">## [1] &quot;Intercept&quot;        &quot;dex_untrt_vs_trt&quot;</span></span>
<span id="cb32-10"><a href="#cb32-10"></a>resLFC_airway &lt;-<span class="st"> </span><span class="kw">lfcShrink</span>(ddsDE_airway, <span class="dt">coef=</span><span class="st">&quot;dex_untrt_vs_trt&quot;</span>, <span class="dt">type=</span><span class="st">&quot;apeglm&quot;</span>)</span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a>DESeq2<span class="op">::</span><span class="kw">plotMA</span>(res, <span class="dt">main =</span> <span class="st">&quot;before lfc shrinkage&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>DESeq2<span class="op">::</span><span class="kw">plotMA</span>(resLFC_airway, <span class="dt">main =</span> <span class="st">&quot;after lfc shrinkage&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="RNA_seq_method_files/figure-html/unnamed-chunk-39-2.png" width="672" /></p>
</div>
<div id="principal-component-analysis" class="section level2">
<h2><span class="header-section-number">4.3</span> Principal Component Analysis</h2>
<p>Data can contain a lot of variables. Some might even be unknown to us. To get an idea of the variance in our data and what variables (principal components) are mainly responsible for this variance we can do a Principal Component Analysis (PCA). A principal component analysis tries to compress a big amount of data into a single point on a plot to show relations or clusters and what principal components cause these clusters.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">#principal component analysis</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>ddsDE_rlog_airway &lt;-<span class="st"> </span>ddsDE_airway <span class="op">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="st">  </span><span class="kw">rlogTransformation</span>() </span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a></span>
<span id="cb34-6"><a href="#cb34-6"></a>ddsDE_rlog_airway <span class="op">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="st">  </span>DESeq2<span class="op">::</span><span class="kw">plotPCA</span>(<span class="dt">intgroup =</span> <span class="kw">c</span>(<span class="st">&quot;dex&quot;</span>, <span class="st">&quot;cell&quot;</span>)) <span class="op">+</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-40-1.png" alt="Figure 12: PCA plot of airway dataset. The clusters show principal component 1 is the treatment variable explaining 40% of the variance in the data. Principal component 2 is the celllines explaining 27% of the variance. It looks like cellline N080611 is the odd one out and the other cellines are fairly simular." width="672" />
<p class="caption">
Figure 12: PCA plot of airway dataset. The clusters show principal component 1 is the treatment variable explaining 40% of the variance in the data. Principal component 2 is the celllines explaining 27% of the variance. It looks like cellline N080611 is the odd one out and the other cellines are fairly simular.
</p>
</div>
<p>PCA compresses the data by reducing the dimensions in the data. A simple example of dimension reduction can be seen in figure 13 and 14. By rotating the line fitted through the data it can be compressed from 2 dimensions to 1 dimension while maintaining the component that cause the most variance in the 2 dimensions.</p>
<div class="figure" style="text-align: center">
<img src="images/PCA1.png" alt="Figure 13: Reads for 2 correlating samples. A principal component line is fitted through it and the datapoints are projected onto the line. Source: Modern Statistics for Modern Biology" width="50%" />
<p class="caption">
Figure 13: Reads for 2 correlating samples. A principal component line is fitted through it and the datapoints are projected onto the line. Source: Modern Statistics for Modern Biology
</p>
</div>
<div class="figure" style="text-align: center">
<img src="images/PCA2.png" alt="Figure 14: The line is rotated so the red dots represent the 2 dimensional data (x and y) in 1 dimension (x). Source: Modern Statistics for Modern Biology" width="50%" />
<p class="caption">
Figure 14: The line is rotated so the red dots represent the 2 dimensional data (x and y) in 1 dimension (x). Source: Modern Statistics for Modern Biology
</p>
</div>
<p>The one dimensional data can be described with an “eigenvalue”. This value represents the variance introduced by a variable. The eigenvalues of a dataset can be plotted in a scree plot.</p>
<div class="figure" style="text-align: center">
<img src="images/scree.png" alt="Figure 15:A scree plot showing the eigenvalues of each dimension. Dimension 1 and 2 (PC1 and PC2) are responsible for most variance in the data so a 2 dimensional PCA plot can accurately portray the data. Source: Modern Statistics for Modern Biology" width="50%" />
<p class="caption">
Figure 15:A scree plot showing the eigenvalues of each dimension. Dimension 1 and 2 (PC1 and PC2) are responsible for most variance in the data so a 2 dimensional PCA plot can accurately portray the data. Source: Modern Statistics for Modern Biology
</p>
</div>
<p>If the eigenvalue of PC3 is about equal to the eigenvalue of PC2 it is not possible to accurately plot the data in 2 dimensions and a 3d PCA plot should be used.</p>
</div>
<div id="transcript-length-bias" class="section level2">
<h2><span class="header-section-number">4.4</span> Transcript length bias</h2>
<p>A much overlooked bias is the transcript length bias. This bias is the result of longer mRNA molecules being broken up into more fragments compared to shorter mRNA’s. This results in overrepresentation of longer genes <em>within</em> samples. It is possible to correct for this within sample variation but doing so introduces variation between samples. Since we are usually interested in the differential expression of genes between samples we choose to leave the transcript length bias as is.<br />
However it is important to be aware of its presence.</p>
<div class="figure" style="text-align: center">
<img src="images/mortazavi2008_transcript_length_bias.jpg" alt="Figure 16:Transcript length bias. Both red and green mRNA's are present in equal amounts in the sample. After producing the cDNA library and mapping the reads to the genome the longer red gene becomes overrepresented. To correct for this overrepresentation a genes expression can be calculated as Reads Per Kilobase Million (RPKM). source: Mortazavi 2008" width="100%" />
<p class="caption">
Figure 16:Transcript length bias. Both red and green mRNA’s are present in equal amounts in the sample. After producing the cDNA library and mapping the reads to the genome the longer red gene becomes overrepresented. To correct for this overrepresentation a genes expression can be calculated as Reads Per Kilobase Million (RPKM). source: Mortazavi 2008
</p>
</div>
<p>To get an idea of the scale of this bias in our dataset we can plot the genelength in basepairs versus the % differentially expressed.</p>
<div class="figure" style="text-align: center">
<img src="RNA_seq_method_files/figure-html/unnamed-chunk-45-1.png" alt="Figure 17) Left: Transcript length bias. Average bp length of all possible isoforms was calculated per gene. Genes were arranged by length and binned per 500 genes and the average genelength of each bin was calculated. The Y axis show the fraction of genes per bin that were differentially expressed. The DESeq2 results turn out to be slightly skewed towards the longer genes. Right: After performing a log fold shrink the bias becomes magnified." width="100%" />
<p class="caption">
Figure 17) Left: Transcript length bias. Average bp length of all possible isoforms was calculated per gene. Genes were arranged by length and binned per 500 genes and the average genelength of each bin was calculated. The Y axis show the fraction of genes per bin that were differentially expressed. The DESeq2 results turn out to be slightly skewed towards the longer genes. Right: After performing a log fold shrink the bias becomes magnified.
</p>
</div>
</div>
</div>
<div id="bibliography" class="section level1">
<h1><span class="header-section-number">5</span> <strong>Bibliography</strong></h1>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Love, M.I., Huber, W., Anders, S. Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2 Genome Biology 15(12):550 (2014)<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Schurch, N. J., Schofield, P., Gierliński, M., Cole, C., Sherstnev, A., Singh, V., Wrobel, N., Gharbi, K., Simpson, G. G., Owen-Hughes, T., Blaxter, M., &amp; Barton, G. J. (2016). How many biological replicates are needed in an RNA-seq experiment and which differential expression tool should you use?. RNA (New York, N.Y.), 22(6), 839–851. <a href="https://doi.org/10.1261/rna.053959.115" class="uri">https://doi.org/10.1261/rna.053959.115</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Conesa, A., Madrigal, P., Tarazona, S. et al. A survey of best practices for RNA-seq data analysis. Genome Biol 17, 13 (2016). <a href="https://doi.org/10.1186/s13059-016-0881-8" class="uri">https://doi.org/10.1186/s13059-016-0881-8</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Tarazona, S., García-Alcalde, F., Dopazo, J., Ferrer, A., &amp; Conesa, A. (2011). Differential expression in RNA-seq: a matter of depth. Genome research, 21(12), 2213–2223. <a href="https://doi.org/10.1101/gr.124321.111" class="uri">https://doi.org/10.1101/gr.124321.111</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Stark, R., Grzelak, M., &amp; Hadfield, J. (2019). RNA sequencing: the teenage years. Nature reviews. Genetics, 20(11), 631–656. <a href="https://doi.org/10.1038/s41576-019-0150-2" class="uri">https://doi.org/10.1038/s41576-019-0150-2</a><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Mortazavi, A., Williams, B., McCue, K. et al. Mapping and quantifying mammalian transcriptomes by RNA-Seq. Nat Methods 5, 621–628 (2008). <a href="https://doi.org/10.1038/nmeth.1226" class="uri">https://doi.org/10.1038/nmeth.1226</a><a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Holmes, S., &amp; Huber, W. (2019). Modern Statistics for Modern Biology (1st ed.) [E-book]. Cambridge University Press. <a href="https://www.huber.embl.de/msmb/" class="uri">https://www.huber.embl.de/msmb/</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Clarke, R. (1946). An application of the Poisson distribution. Journal of the Institute of Actuaries, 72(3), 481-481. <a href="doi:10.1017/S0020268100035435" class="uri">doi:10.1017/S0020268100035435</a><a href="#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
